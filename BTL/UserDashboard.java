package BTL;

import javax.swing.*;
import javax.swing.border.Border;
import javax.swing.border.EmptyBorder;
import javax.swing.border.LineBorder;
import java.awt.*;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;

public class UserDashboard extends JFrame {
    private String username;
    private String fullname;
    private String email;

    // M√†u s·∫Øc ƒë∆∞·ª£c ch·ªçn theo b·∫£ng m√†u hi·ªán ƒë·∫°i
    private static final Color PRIMARY_COLOR = new Color(41, 128, 185); // Xanh d∆∞∆°ng ƒë·∫≠m
    private static final Color BACKGROUND_COLOR = new Color(236, 240, 241); // X√°m tr·∫Øng (Clouds)
    private static final Color CARD_BACKGROUND_COLOR = Color.WHITE;
    private static final Color BUTTON_COLOR = new Color(39, 174, 96); // Xanh l√° ƒë·∫≠m (Emerald)
    private static final Color DANGER_COLOR = new Color(192, 57, 43); // ƒê·ªè ƒë·∫≠m (Alizarin)
    private static final Color TEXT_COLOR = new Color(52, 73, 94); // X√°m xanh (Wet Asphalt)
    private static final Font LABEL_FONT = new Font("Segoe UI", Font.BOLD, 14);

    // Kh·ªüi t·∫°o c√°c JLabel ƒë·ªÉ c√≥ th·ªÉ c·∫≠p nh·∫≠t th√¥ng tin ngay l·∫≠p t·ª©c
    private JLabel lblFullnameValue;
    private JLabel lblEmailValue;

    public UserDashboard(String username, String fullname, String email) {
        this.username = username;
        this.fullname = fullname;
        this.email = email;

        // --- C·∫•u h√¨nh Khung ch√≠nh ---
        setTitle("Trang c√° nh√¢n"); 
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);
        
        setLayout(new BorderLayout(20, 20)); 
        getContentPane().setBackground(BACKGROUND_COLOR);

        // --- 1. Ti√™u ƒë·ªÅ v√† ·∫¢nh ƒë·∫°i di·ªán (Profile Header) ---
        JPanel headerPanel = createHeaderPanel();
        add(headerPanel, BorderLayout.NORTH);

        // --- 2. Panel Th√¥ng tin ch√≠nh (Card Design - B·ªë c·ª•c co gi√£n) ---
        JPanel mainContentPanel = createMainContentPanel();
        add(mainContentPanel, BorderLayout.CENTER);

        // --- 3. Panel N√∫t ch·ª©c nƒÉng ---
        JPanel btnsPanel = createButtonsPanel();
        add(btnsPanel, BorderLayout.SOUTH);

        // --- 4. X·ª≠ l√Ω s·ª± ki·ªán ---
        ((JButton)btnsPanel.getComponent(0)).addActionListener(e -> new EditInfoDialog(this, "S·ª≠a th√¥ng tin", true).setVisible(true));
        ((JButton)btnsPanel.getComponent(1)).addActionListener(e -> new ChangePasswordDialog(this, "ƒê·ªïi m·∫≠t kh·∫©u", true).setVisible(true));
        ((JButton)btnsPanel.getComponent(2)).addActionListener(e -> {
            JOptionPane.showMessageDialog(this, "ƒê√£ ƒëƒÉng xu·∫•t", "Th√¥ng b√°o", JOptionPane.INFORMATION_MESSAGE);
            dispose();
        });
        
        pack();
        setMinimumSize(new Dimension(600, 500)); 
        setVisible(true);
    }
    
    // ====================================================================
    // --- PH·∫¶N 1: KH·ªûI T·∫†O C√ÅC PANEL V√Ä TH√ÄNH PH·∫¶N CH√çNH ---
    // ====================================================================

    private JPanel createHeaderPanel() {
        JPanel headerPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 20, 15));
        headerPanel.setBackground(PRIMARY_COLOR);
        headerPanel.setBorder(new EmptyBorder(15, 0, 15, 0));

        // Icon Avatar
        JLabel avatar = new JLabel("üßë", SwingConstants.CENTER); 
        avatar.setFont(new Font("Segoe UI Emoji", Font.PLAIN, 40));
        avatar.setBorder(BorderFactory.createLineBorder(Color.WHITE, 2));
        avatar.setOpaque(true);
        avatar.setBackground(new Color(241, 196, 15)); 
        avatar.setPreferredSize(new Dimension(80, 80));
        headerPanel.add(avatar);

        JLabel title = new JLabel("TH√îNG TIN C√Å NH√ÇN", SwingConstants.CENTER);
        title.setFont(new Font("Segoe UI", Font.BOLD, 30));
        title.setForeground(Color.WHITE);
        headerPanel.add(title);
        
        return headerPanel;
    }

    private JPanel createMainContentPanel() {
        JPanel mainContentPanel = new JPanel(new GridBagLayout()); 
        mainContentPanel.setBackground(BACKGROUND_COLOR);
        mainContentPanel.setBorder(new EmptyBorder(0, 50, 0, 50)); 

        JPanel infoCard = new RoundedPanel(15, CARD_BACKGROUND_COLOR); 
        infoCard.setLayout(new GridBagLayout()); 
        
        GridBagConstraints gbcInfo = new GridBagConstraints();
        gbcInfo.insets = new Insets(15, 20, 15, 20); 
        gbcInfo.fill = GridBagConstraints.HORIZONTAL; 
        gbcInfo.weightx = 1.0;

        int row = 0;
        row = addInfoRow(infoCard, gbcInfo, "T√™n ƒëƒÉng nh·∫≠p:", this.username, row);
        row = addInfoRow(infoCard, gbcInfo, "H·ªç v√† t√™n:", this.fullname, row);
        row = addInfoRow(infoCard, gbcInfo, "Email:", this.email, row);
        row = addInfoRow(infoCard, gbcInfo, "Vai tr√≤:", "USER", row);

        // THI·∫æT L·∫¨P CO GI√ÉN
        GridBagConstraints gbcMain = new GridBagConstraints();
        gbcMain.insets = new Insets(20, 0, 20, 0); 
        gbcMain.weightx = 1.0; 
        gbcMain.weighty = 1.0; 
        gbcMain.fill = GridBagConstraints.BOTH; 
        gbcMain.anchor = GridBagConstraints.CENTER;

        mainContentPanel.add(infoCard, gbcMain);
        
        return mainContentPanel;
    }

    private JPanel createButtonsPanel() {
        JPanel btnsPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 30, 20)); 
        btnsPanel.setBackground(BACKGROUND_COLOR);
        btnsPanel.setBorder(new EmptyBorder(0, 0, 20, 0));

        JButton btnEdit = createStyledButton("S·ª≠a th√¥ng tin", BUTTON_COLOR);
        JButton btnChange = createStyledButton("ƒê·ªïi m·∫≠t kh·∫©u", PRIMARY_COLOR);
        JButton btnLogout = createStyledButton("ƒêƒÉng xu·∫•t", DANGER_COLOR);

        btnsPanel.add(btnEdit);
        btnsPanel.add(btnChange);
        btnsPanel.add(btnLogout);
        return btnsPanel;
    }

    // ====================================================================
    // --- PH·∫¶N 2: H√ÄM H·ªñ TR·ª¢ V√Ä STYLE ---
    // ====================================================================
    
    // Custom Panel cho hi·ªáu ·ª©ng bo g√≥c
    private class RoundedPanel extends JPanel {
        private int cornerRadius = 15;
        private Color bgColor;

        public RoundedPanel(int radius, Color bgColor) {
            super();
            this.cornerRadius = radius;
            this.bgColor = bgColor;
            setOpaque(false);
        }

        @Override
        protected void paintComponent(Graphics g) {
            super.paintComponent(g);
            Dimension arcs = new Dimension(cornerRadius, cornerRadius);
            int width = getWidth();
            int height = getHeight();
            Graphics2D graphics = (Graphics2D) g;
            graphics.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);

            graphics.setColor(bgColor);
            graphics.fillRoundRect(0, 0, width-1, height-1, arcs.width, arcs.height);
            graphics.setColor(new Color(189, 195, 199)); 
            graphics.drawRoundRect(0, 0, width-1, height-1, arcs.width, arcs.height);
        }
    }

    // Custom Panel cho hi·ªáu ·ª©ng ƒë·ªï b√≥ng/vi·ªÅn cho tr∆∞·ªùng Input trong Dialog
    private class StyledInputFieldPanel extends JPanel {
        public StyledInputFieldPanel(JComponent field) {
            super(new BorderLayout());
            setBorder(BorderFactory.createCompoundBorder(
                new LineBorder(new Color(220, 220, 220), 1), // Vi·ªÅn m·ªèng
                new EmptyBorder(5, 5, 5, 5) // Padding b√™n trong
            ));
            setBackground(CARD_BACKGROUND_COLOR);
            add(field, BorderLayout.CENTER);
        }
    }

    private JButton createStyledButton(String text, Color baseColor) {
        JButton button = new JButton(text);
        button.setFont(new Font("Segoe UI", Font.BOLD, 14));
        button.setBackground(baseColor);
        button.setForeground(Color.WHITE);
        button.setFocusPainted(false);
        button.setBorder(BorderFactory.createEmptyBorder(12, 25, 12, 25));

        button.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseEntered(MouseEvent evt) {
                button.setBackground(baseColor.darker());
            }

            @Override
            public void mouseExited(MouseEvent evt) {
                button.setBackground(baseColor);
            }
        });
        return button;
    }

    private int addInfoRow(JPanel panel, GridBagConstraints gbc, String labelText, String valueText, int row) {
        JLabel label = new JLabel(labelText);
        label.setFont(new Font("Segoe UI", Font.PLAIN, 16));
        label.setForeground(TEXT_COLOR); 

        gbc.gridx = 0;
        gbc.gridy = row;
        gbc.weightx = 0; 
        gbc.anchor = GridBagConstraints.WEST;
        panel.add(label, gbc);

        JLabel value = new JLabel(valueText);
        value.setFont(new Font("Segoe UI", Font.BOLD, 16));
        value.setForeground(PRIMARY_COLOR.darker());
        
        JPanel fieldPanel = new RoundedPanel(8, new Color(248, 249, 250)); 
        fieldPanel.setLayout(new BorderLayout());
        fieldPanel.setBorder(new EmptyBorder(8, 15, 8, 15));
        fieldPanel.add(value, BorderLayout.CENTER);

        if (labelText.contains("H·ªç v√† t√™n:")) lblFullnameValue = value;
        if (labelText.contains("Email:")) lblEmailValue = value;

        gbc.gridx = 1;
        gbc.gridy = row;
        gbc.weightx = 1.0; 
        gbc.anchor = GridBagConstraints.EAST;
        panel.add(fieldPanel, gbc);
        
        return row + 1;
    }

    // ====================================================================
    // --- PH·∫¶N 3: CUSTOM DIALOGS (N√¢ng c·∫•p giao di·ªán) ---
    // ====================================================================
    
    // H√†m t·∫°o input field ƒë∆∞·ª£c n√¢ng c·∫•p
    private JPanel createStyledLabelField(String labelText, JTextField field) {
        JPanel p = new JPanel(new BorderLayout(0, 5));
        p.setBackground(CARD_BACKGROUND_COLOR);
        JLabel label = new JLabel(labelText);
        label.setFont(LABEL_FONT);
        label.setForeground(TEXT_COLOR); // Th√™m m√†u s·∫Øc cho label
        
        field.setBorder(BorderFactory.createEmptyBorder(5, 10, 5, 10)); // B·ªè vi·ªÅn m·∫∑c ƒë·ªãnh
        field.setFont(new Font("Segoe UI", Font.PLAIN, 15));
        
        p.add(label, BorderLayout.NORTH);
        // S·ª≠ d·ª•ng StyledInputFieldPanel ƒë·ªÉ th√™m vi·ªÅn/ƒë·ªï b√≥ng cho field
        p.add(new StyledInputFieldPanel(field), BorderLayout.CENTER); 
        return p;
    }

    // H√†m t·∫°o password field ƒë∆∞·ª£c n√¢ng c·∫•p
    private JPanel createStyledLabelField(String labelText, JPasswordField field) {
        JPanel p = new JPanel(new BorderLayout(0, 5));
        p.setBackground(CARD_BACKGROUND_COLOR);
        JLabel label = new JLabel(labelText);
        label.setFont(LABEL_FONT);
        label.setForeground(TEXT_COLOR); // Th√™m m√†u s·∫Øc cho label
        
        field.setBorder(BorderFactory.createEmptyBorder(5, 10, 5, 10)); // B·ªè vi·ªÅn m·∫∑c ƒë·ªãnh
        field.setFont(new Font("Segoe UI", Font.PLAIN, 15));
        
        p.add(label, BorderLayout.NORTH);
        // S·ª≠ d·ª•ng StyledInputFieldPanel ƒë·ªÉ th√™m vi·ªÅn/ƒë·ªï b√≥ng cho field
        p.add(new StyledInputFieldPanel(field), BorderLayout.CENTER); 
        return p;
    }

    private class EditInfoDialog extends JDialog {
        public EditInfoDialog(Frame owner, String title, boolean modal) {
            super(owner, title, modal);
            setLocationRelativeTo(owner);
            setLayout(new BorderLayout(10, 10));
            getContentPane().setBackground(BACKGROUND_COLOR);
            
            JLabel dialogTitle = new JLabel("C·∫≠p nh·∫≠t Th√¥ng tin c√° nh√¢n", SwingConstants.CENTER);
            dialogTitle.setFont(new Font("Segoe UI", Font.BOLD, 20));
            dialogTitle.setForeground(PRIMARY_COLOR);
            dialogTitle.setBorder(new EmptyBorder(15, 0, 15, 0));
            add(dialogTitle, BorderLayout.NORTH);

            // N√¢ng c·∫•p: D√πng JPanel l·ªìng nhau ƒë·ªÉ tƒÉng kho·∫£ng c√°ch v√† l√†m ƒë·∫πp h∆°n
            JPanel inputContainer = new RoundedPanel(15, CARD_BACKGROUND_COLOR);
            inputContainer.setLayout(new GridBagLayout()); 
            inputContainer.setBorder(new EmptyBorder(30, 40, 30, 40)); // TƒÉng padding b√™n trong

            GridBagConstraints gbc = new GridBagConstraints();
            gbc.fill = GridBagConstraints.HORIZONTAL;
            gbc.weightx = 1.0;
            gbc.insets = new Insets(10, 0, 10, 0); // Kho·∫£ng c√°ch gi·ªØa c√°c tr∆∞·ªùng

            JTextField txtFullname = new JTextField(((UserDashboard)owner).fullname);
            JTextField txtEmail = new JTextField(((UserDashboard)owner).email);
            
            gbc.gridy = 0;
            inputContainer.add(createStyledLabelField("H·ªç v√† t√™n m·ªõi:", txtFullname), gbc);
            
            gbc.gridy = 1;
            inputContainer.add(createStyledLabelField("Email m·ªõi:", txtEmail), gbc);

            add(inputContainer, BorderLayout.CENTER);

            JPanel btnPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 20, 15));
            btnPanel.setBackground(BACKGROUND_COLOR);
            
            JButton btnSave = createStyledButton("L∆∞u Thay ƒê·ªïi", BUTTON_COLOR);
            JButton btnCancel = createStyledButton("H·ªßy", DANGER_COLOR);

            btnSave.addActionListener(e -> {
                String newFull = txtFullname.getText().trim();
                String newEmail = txtEmail.getText().trim();
                
                if (newFull.isEmpty() || newEmail.isEmpty()) {
                    JOptionPane.showMessageDialog(this, "Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!", "L·ªói", JOptionPane.ERROR_MESSAGE);
                    return;
                }
                
                UserDashboard parent = (UserDashboard) owner;
                parent.fullname = newFull;
                parent.email = newEmail;
                parent.lblFullnameValue.setText(newFull);
                parent.lblEmailValue.setText(newEmail);

                JOptionPane.showMessageDialog(this, "ƒê√£ c·∫≠p nh·∫≠t hi·ªÉn th·ªã (local).", "Th√†nh c√¥ng", JOptionPane.INFORMATION_MESSAGE);
                dispose();
            });
            btnCancel.addActionListener(e -> dispose());

            btnPanel.add(btnSave);
            btnPanel.add(btnCancel);
            add(btnPanel, BorderLayout.SOUTH);
            
            pack();
            setResizable(false);
            setMinimumSize(new Dimension(450, 350)); // ƒê·∫£m b·∫£o k√≠ch th∆∞·ªõc t·ªëi thi·ªÉu ƒë·∫πp
        }
    }

    private class ChangePasswordDialog extends JDialog {
        public ChangePasswordDialog(Frame owner, String title, boolean modal) {
            super(owner, title, modal);
            setLocationRelativeTo(owner);
            setLayout(new BorderLayout(10, 10));
            getContentPane().setBackground(BACKGROUND_COLOR);

            JLabel dialogTitle = new JLabel("ƒê·ªïi m·∫≠t kh·∫©u t√†i kho·∫£n", SwingConstants.CENTER);
            dialogTitle.setFont(new Font("Segoe UI", Font.BOLD, 20));
            dialogTitle.setForeground(PRIMARY_COLOR);
            dialogTitle.setBorder(new EmptyBorder(15, 0, 15, 0));
            add(dialogTitle, BorderLayout.NORTH);

            // N√¢ng c·∫•p: D√πng JPanel l·ªìng nhau ƒë·ªÉ tƒÉng kho·∫£ng c√°ch v√† l√†m ƒë·∫πp h∆°n
            JPanel inputContainer = new RoundedPanel(15, CARD_BACKGROUND_COLOR);
            inputContainer.setLayout(new GridBagLayout()); 
            inputContainer.setBorder(new EmptyBorder(30, 40, 30, 40)); // TƒÉng padding b√™n trong

            GridBagConstraints gbc = new GridBagConstraints();
            gbc.fill = GridBagConstraints.HORIZONTAL;
            gbc.weightx = 1.0;
            gbc.insets = new Insets(10, 0, 10, 0); // Kho·∫£ng c√°ch gi·ªØa c√°c tr∆∞·ªùng

            JPasswordField oldp = new JPasswordField(18);
            JPasswordField newp = new JPasswordField(18);
            JPasswordField repl = new JPasswordField(18);

            gbc.gridy = 0;
            inputContainer.add(createStyledLabelField("M·∫≠t kh·∫©u c≈©:", oldp), gbc);
            
            gbc.gridy = 1;
            inputContainer.add(createStyledLabelField("M·∫≠t kh·∫©u m·ªõi:", newp), gbc);
            
            gbc.gridy = 2;
            inputContainer.add(createStyledLabelField("Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi:", repl), gbc);

            add(inputContainer, BorderLayout.CENTER);

            JPanel btnPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 20, 15));
            btnPanel.setBackground(BACKGROUND_COLOR);

            JButton btnChange = createStyledButton("X√°c nh·∫≠n ƒê·ªïi", PRIMARY_COLOR);
            JButton btnCancel = createStyledButton("H·ªßy", DANGER_COLOR);
            
            btnChange.addActionListener(e -> {
                String np = new String(newp.getPassword());
                String rp = new String(repl.getPassword());
                String op = new String(oldp.getPassword());

                if (op.isEmpty() || np.isEmpty() || rp.isEmpty()) {
                    JOptionPane.showMessageDialog(this, "Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng m·∫≠t kh·∫©u!", "L·ªói", JOptionPane.ERROR_MESSAGE); return;
                }
                if (!np.equals(rp)) { 
                    JOptionPane.showMessageDialog(this, "M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp nhau.", "L·ªói", JOptionPane.ERROR_MESSAGE); return; 
                }
                
                boolean isSuccess = true; 
                
                if (isSuccess) { 
                    JOptionPane.showMessageDialog(this, "ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!", "Th√†nh c√¥ng", JOptionPane.INFORMATION_MESSAGE);
                    dispose();
                } else { 
                    JOptionPane.showMessageDialog(this, "L·ªói: M·∫≠t kh·∫©u c≈© kh√¥ng ƒë√∫ng ho·∫∑c l·ªói m√°y ch·ªß.", "L·ªói", JOptionPane.ERROR_MESSAGE);
                }
            });
            btnCancel.addActionListener(e -> dispose());

            btnPanel.add(btnChange);
            btnPanel.add(btnCancel);
            add(btnPanel, BorderLayout.SOUTH);

            pack();
            setResizable(false);
            setMinimumSize(new Dimension(450, 400)); // ƒê·∫£m b·∫£o k√≠ch th∆∞·ªõc t·ªëi thi·ªÉu ƒë·∫πp
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> {
            new UserDashboard("nguyenvana", "Nguy·ªÖn VƒÉn A", "vana@example.com");
        });
    }
}